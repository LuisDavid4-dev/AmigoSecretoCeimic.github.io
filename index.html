<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="stylesheet" href="estilos.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intercambio NavideÃ±o 2025</title>
</head>
<body>
    <div class="snowflakes" aria-hidden="true"></div>
    <div id="christmas-loader">
        <img src="Bienvenida.webp" alt="Feliz Navidad"> 
    </div>

    <div id="user-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="modal-header">
                </div>
            <div class="modal-body">
                </div>
        </div>
    </div>
 
    <header class="navidad-header">
        <div class="header-content-wrapper"> <div class="header-line">
                <span class="arbol-decor arbol-izq">ğŸ„</span> 
                <h1>Intercambio NavideÃ±o 2025</h1>
                <span class="arbol-decor arbol-der">ğŸ„</span> 
            </div>
            
            <div class="header-line">
                <span class="estrella estrella-izq">âœ¨</span>
                <h2 class="titulo-rojo-navidad">Â¡Feliz Navidad!</h2>
                <span class="estrella estrella-der">âœ¨</span>
            </div>
            
            </div>
    </header>

    <div id="search-container">
        <input type="text" id="user-search-input" placeholder="Buscar amigo secreto...">
        <button id="clear-search-btn" style="display: none;">&times;</button>
    </div>
    
    <div class="product-grid">
    </div>

    <script>
        // --- 1. FUNCIONES DE UTILERÃA (DEFINIDAS PRIMERO) ---

        function adjustSnowflakeHeight() {
            const snowflakes = document.querySelector('.snowflakes');
            // 1. Altura total del contenido (incluye el scroll).
            const totalContentHeight = document.body.scrollHeight;
            
            // 2. Altura visible de la ventana.
            const minHeight = window.innerHeight;
            
            // ğŸ”‘ CORRECCIÃ“N: Usamos el mÃ¡ximo entre la altura del contenido y la altura visible de la ventana.
            const requiredHeight = Math.max(totalContentHeight, minHeight);

            snowflakes.style.height = `${requiredHeight}px`;
        }
        
Â  Â  Â  Â  function createSnowflake() {
Â  Â  Â  Â  Â  Â  const snowflake = document.createElement('div');
Â  Â  Â  Â  Â  Â  snowflake.className = 'snowflake';
Â  Â  Â  Â  Â  Â  snowflake.innerHTML = 'â€¢'; 
Â  Â  Â  Â  Â  Â  const startX = Math.random() * 100;
Â  Â  Â  Â  Â  Â  snowflake.style.left = `${startX}vw`;
Â  Â  Â  Â  Â  Â  const size = Math.random() * 0.5 + 0.8; 
Â  Â  Â  Â  Â  Â  snowflake.style.fontSize = `${size}em`;
Â  Â  Â  Â  Â  Â  const duration = Math.random() * 10 + 10; 
Â  Â  Â  Â  Â  Â  snowflake.style.animationDuration = `${duration}s`;
Â  Â  Â  Â  Â  Â  const delay = Math.random() * 10;
Â  Â  Â  Â  Â  Â  snowflake.style.animationDelay = `${delay}s`;
Â  Â  Â  Â  Â  Â  return snowflake;
Â  Â  Â  Â  }

Â  Â  Â  Â  function initSnowfall() {
Â  Â  Â  Â  Â  Â  const snowfallContainer = document.querySelector('.snowflakes');
Â  Â  Â  Â  Â  Â  const numberOfSnowflakes = 50; 
Â  Â  Â  Â  Â  Â  for (let i = 0; i < numberOfSnowflakes; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  snowfallContainer.appendChild(createSnowflake());
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

        // --- 2. CÃ“DIGO DEL MODAL (Mantenido) ---

Â  Â  Â  Â  const modal = document.getElementById('user-modal');
Â  Â  Â  Â  const closeBtn = document.querySelector('.close-btn');

Â  Â  Â  Â  function openModal(id, name, imgSrc, basicInfo, descripcion, obsequios) {
Â  Â  Â  Â  Â  Â  const modalHeader = document.querySelector('.modal-header');
Â  Â  Â  Â  Â  Â  const modalBody = document.querySelector('.modal-body');
            
            document.body.classList.add('modal-open');

Â  Â  Â  Â  Â  Â  const formattedBasicInfo = basicInfo
Â  Â  Â  Â  Â  Â  Â  Â  .split(', ') 
Â  Â  Â  Â  Â  Â  Â  Â  .map(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parts = item.split(': '); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (parts.length === 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `<strong>${parts[0]}:</strong><br> ${parts[1]}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return item; 
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .join('<br>'); 

Â  Â  Â  Â  Â  Â modalHeader.innerHTML =
Â  Â  Â  Â  Â  Â  Â  Â  '<div class="modal-title">'+
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<h3 class="modal-title-h3">'+name+'</h3>'+
Â  Â  Â  Â  Â  Â  Â  Â  '</div>'+
Â  Â  Â  Â  Â  Â  Â  Â  '<div class="modal-header-content-wrapper">'+
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<div class="modal-visual-info">'+
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<img src="fotos/'+imgSrc+'" alt="Foto de '+name+'" class="modal-img">'+
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<div class="modal-info-top">'+
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<p>'+formattedBasicInfo+'</p>'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '</div>'+
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '</div>'+
Â  Â  Â  Â  Â  Â  Â  Â  '</div>';

            const titleElement = modalHeader.querySelector('.modal-title-h3');

            // Comprobamos la condiciÃ³n: Si el ID es igual a 1
            if (id === 6 || id === 8) {
                // Reducir el tamaÃ±o de la fuente para ese usuario especÃ­fico
                titleElement.style.fontSize = '1.4em'; // Ejemplo: un tamaÃ±o mÃ¡s pequeÃ±o
                titleElement.style.color = 'var(--azul-profundo)'; // Opcional: cambiar el color
            }

            const formattedObsequios = obsequios
                    .split('|')
                    .map(item => {
                        // Ejemplo: "Reloj masculino(https://falabella.com)"
                        const match = item.match(/(.+)\((https?:\/\/.+)\)/);
                        if (match) {
                            const nombre = match[1].trim();
                            const url = match[2].trim();
                            return `<a href="${url}" target="_blank">${nombre}</a>`;
                        }
                        return item.trim();
                    })
                    .join('<br>');


Â  Â  Â  Â  Â  Â  modalBody.innerHTML =
                '<div class="modal-divider"></div>'+
                '<h4>Descripcion:</h4>'+
Â  Â  Â  Â  Â  Â  Â  Â  '<p class="descripcion-class">'+descripcion+'</p>'+
Â  Â  Â  Â  Â  Â  Â  Â  '<h4>Lista de posibles regalos:</h4>'+
Â  Â  Â  Â  Â  Â  Â  Â  '<p>'+formattedObsequios+'</p>';

            const descripcionElement = modalBody.querySelector('.descripcion-class');

            if (id === 8) {
                // Reducir el tamaÃ±o de la fuente para ese usuario especÃ­fico
                descripcionElement.style.fontSize = '0.8em'; // Ejemplo: un tamaÃ±o mÃ¡s pequeÃ±o
            }

Â  Â  Â  Â  Â  Â  modal.style.display = 'flex';
Â  Â  Â  Â  }

Â  Â  Â  Â  closeBtn.onclick = function () {
Â  Â  Â  Â  Â  Â  modal.style.display = 'none';
Â  Â  Â  Â  }

Â  Â  Â  Â  window.onclick = function (event) {
Â  Â  Â  Â  Â  Â  if (event.target === modal) {
Â  Â  Â  Â  Â  Â  Â  Â  modal.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
        
        let allUserData = []; // Almacena los datos originales de datos.json
        let isChristmasDay = false;
        // --- 3. BLOQUE PRINCIPAL DE CARGA (document.addEventListener('DOMContentLoaded')) ---
        // Este bloque ahora contiene toda la lÃ³gica de inicio.

        const searchInput = document.getElementById('user-search-input');
        const clearButton = document.getElementById('clear-search-btn');
        const grid = document.querySelector('.product-grid');

        const FIXED_ICON_MAP = ["ğŸŒŸ", "ğŸ¦Œ", "ğŸ", "ğŸ””", "â„ï¸", "ğŸ§¤", "â›„", "â˜•", "ğŸ„", "ğŸ¬"];

        function activateChristmasDayMode() {
            const today = new Date();
            // Diciembre es 11, dÃ­a 25.
            const isChristmasDay = today.getMonth() === 11 && today.getDate() === 19;
            // Para pruebas puedes cambiar a: const isChristmasDay = true; 

            if (isChristmasDay) {
                // 1. CAMBIAR EL TÃTULO
                const mainTitle = document.querySelector('.titulo-rojo-navidad');
                if (mainTitle) {
                    mainTitle.innerHTML = 'Â¡Es Hoy! ğŸ…ğŸ';
                    mainTitle.style.fontSize = '5em'; 
                    mainTitle.style.color = 'var(--verde-navidad)'; 
                }
                
                // 2. REEMPLAZAR DECORACIONES DEL HEADER
                const arbolDecor = document.querySelectorAll('.arbol-decor');
                arbolDecor.forEach(decor => {
                    decor.innerHTML = 'ğŸ¦Œ'; // Renos
                    decor.style.color = 'var(--rojo-navidad)'; 
                });

                const estrellaDecor = document.querySelectorAll('.estrella-decor');
                estrellaDecor.forEach(decor => {
                    decor.innerHTML = 'ğŸ'; // Regalos
                    decor.style.fontSize = '3em';
                });

                // 3. ACTIVAR EFECTO VISUAL
                document.body.style.backgroundImage = 'radial-gradient(circle, rgba(255,255,255,0.3) 1px, transparent 1px)';
                document.body.style.backgroundSize = '50px 50px';
                document.body.style.animation = 'none'; 
                
                // Opcional: Cambiar el color del borde de las tarjetas
                document.documentElement.style.setProperty('--azul-hielo-vivo', 'var(--rojo-navidad)');
            }
        }

        function renderCards(data) {
            grid.innerHTML = ''; 

            if (data.length === 0) {
                grid.innerHTML = '<p class="no-results-message">ğŸ¥º Â¡Oh no! No se encontraron usuarios que coincidan con la bÃºsqueda.</p>';
                return;
            }

            data.forEach((amigo, index) => {
                const card = document.createElement('div');
                card.className = 'product-card';
                
                // ğŸ”‘ LÃ³gica de Ãcono Fijo basado en el Ã­ndice (para que no cambie al filtrar)
                // Se usa el ID o el Ã­ndice para calcular un valor entre 0 y 9.
                // Si el JSON tiene un ID, serÃ­a mejor usarlo. AquÃ­ usamos el Ã­ndice:
                const fixedIconIndex = amigo.id % FIXED_ICON_MAP.length; 
                const defaultCardIcon = FIXED_ICON_MAP[fixedIconIndex];
                
                // LÃ³gica final del Ãcono: Si es Navidad, usa PapÃ¡ Noel, sino, usa el Ã­cono fijo.
                const cardIcon = isChristmasDay ? 'ğŸ…' : defaultCardIcon;
                
                const formattedHobbies = amigo.hobbies
                .split('|')
                .map(hobby => hobby.trim())
                .join('<br>');


                card.onclick = () => openModal(
                    amigo.id,
                    amigo.Nombre_ApellidoPaterno,
                    amigo.Foto,
                    `Hobbies: ${formattedHobbies}, Ãrea: ${amigo.Area}`,
                    amigo.descripcion,
                    amigo.lista_Regalos
                );
                
                card.innerHTML = 
                    '<span class="card-icon-emoji">'+cardIcon+'</span>'+
                    '<br>'+
                    '<div class="card-content">'+
                        '<img src="fotos/'+amigo.Foto+'" alt="Foto de '+amigo.Nombre_ApellidoPaterno+'">'+
                        '<h3>'+amigo.Nombre_ApellidoPaterno+'</h3>'+
                    '</div>'+
                    '<p>'+amigo.Area.split('.')[0]+'</p>';
                    
                grid.appendChild(card);
            });
            
            // Ajusta la altura de la nieve despuÃ©s de renderizar el contenido
            setTimeout(adjustSnowflakeHeight, 50);
        }


        // --- FUNCIÃ“N: FILTRA EL CONTENIDO ---
        function filterCards() {
            const query = searchInput.value.toLowerCase().trim();
            
            // Controlar la visibilidad de la "X"
            if (query.length > 0) {
                clearButton.style.display = 'inline-block';
            } else {
                clearButton.style.display = 'none';
            }

            if (query === '') {
                // Si el campo estÃ¡ vacÃ­o, muestra todos los datos
                renderCards(allUserData);
                return;
            }

            // Filtra los datos: busca por Nombre_ApellidoPaterno
            const filteredData = allUserData.filter(amigo => {
                const fullName = `${amigo.Nombre_ApellidoPaterno || ''}`.toLowerCase();
                return fullName.includes(query);
            });

            // Vuelve a renderizar con los datos filtrados
            renderCards(filteredData);
        }

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  const iconList = ["ğŸ…", "ğŸ", "ğŸ””", "âœ¨", "â›„", "ğŸ¦Œ", "â˜•", "â„ï¸", "ğŸ§¤", "ğŸ„", "ğŸŒŸ", "ğŸ¬"];
Â  Â  Â  Â  Â  Â  const grid = document.querySelector('.product-grid');

            // 1. INICIALIZAR NIEVE INMEDIATAMENTE
            initSnowfall();

            activateChristmasDayMode();
            
            // 2. AÃ‘ADIR LISTENER DE REDIMENSIONAMIENTO (resize)
            // Esto es crucial para reajustar la altura si el usuario cambia el tamaÃ±o de la ventana (o gira el mÃ³vil)
            window.addEventListener('resize', () => {
                // Usamos setTimeout para dar tiempo a que el navegador termine el cÃ¡lculo de layout
                setTimeout(adjustSnowflakeHeight, 50);
            });

            searchInput.addEventListener('input', filterCards); 
        
            // BotÃ³n X: borra y restablece el filtro
            clearButton.addEventListener('click', () => { 
                searchInput.value = '';
                filterCards();
            });

            searchInput.addEventListener('focus', () => {
                // Usamos el contenedor para asegurarnos de que la barra de bÃºsqueda y el botÃ³n 'X' 
                // se vean cÃ³modamente en la parte superior de la pantalla.
                const searchContainer = document.getElementById('search-container');
                searchContainer.scrollIntoView({ 
                    behavior: 'smooth', // AnimaciÃ³n suave
                    block: 'start'      // Alinea el elemento en la parte superior del viewport
                });
            });

Â  Â  Â  Â  Â  Â  // 3. CARGAR DATOS (fetch)
Â  Â  Â  Â  Â  Â  fetch('datos.json')
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Usar localeCompare es mejor para la ordenaciÃ³n de strings que incluye tildes y otros caracteres especiales.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return a.Area.localeCompare(b.Area);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allUserData = data; 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Renderiza la lista completa al inicio
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderCards(allUserData);
                    // âœ… AJUSTE FINAL: Se llama despuÃ©s de que las tarjetas estÃ¡n en el DOM.
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error al cargar datos.json:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid.innerHTML = '<p>No se pudieron cargar los datos del intercambio.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  });
            const loader = document.getElementById('christmas-loader');
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 500);
            }, 1500);

            // 5. LISTENERS DEL MODAL (AÃ±adimos los listeners al DOMContentLoaded para que funcionen)
            closeBtn.onclick = function () {
Â  Â  Â  Â  Â  Â      modal.style.display = 'none';
                document.body.classList.remove('modal-open');
Â  Â  Â  Â      }

Â  Â  Â  Â      window.onclick = function (event) {
Â  Â  Â  Â  Â  Â      if (event.target === modal) {
Â  Â  Â  Â  Â  Â  Â  Â      modal.style.display = 'none';
                    document.body.classList.remove('modal-open');
Â  Â  Â  Â  Â  Â      }
Â  Â  Â  Â      }

Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>